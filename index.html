<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicita√ß√£o de Interdi√ß√£o - SMU JF</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --primary: #0066cc; --secondary: #003366; }
        body { font-family: 'Segoe UI', sans-serif; background: #f8f9fa; }
        .header { background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: white; padding: 1.5rem 0; }
        .form-section { background: white; border-radius: 10px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .required::after { content: " *"; color: red; }
        .section-title { color: var(--primary); border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-bottom: 20px; }
        .logo-header { max-height: 70px; margin-right: 15px; }
        .protocolo-info { background: #e7f3ff; border-left: 4px solid var(--primary); padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .hidden-section { display: none; }
        .section-divider { border-top: 2px dashed #dee2e6; margin: 2rem 0; padding-top: 2rem; }
        .btn-confirmar { margin-top: 10px; }
        .participantes-confirmados { background: #e7f7e7; border: 2px solid #28a745; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .google-forms-warning { background: #fff3cd; border: 2px solid #ffc107; padding: 20px; border-radius: 10px; margin: 20px 0; }
        .preview-container { max-height: 400px; overflow-y: auto; border: 1px solid #dee2e6; padding: 15px; border-radius: 5px; background: #f8f9fa; }
        @media (max-width: 768px) {
            .logo-header { max-height: 50px; margin-right: 10px; }
            .header { padding: 1rem 0; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="d-flex align-items-center justify-content-center">
                <img src="logo-horizontal.png" 
                     alt="Logo SMU Juiz de Fora" 
                     class="logo-header">
                <div class="text-center">
                    <h1 class="mb-1" style="font-size: 1.8rem;">SMU Juiz de Fora</h1>
                    <p class="mb-0" style="font-size: 0.9rem;">Secretaria de Mobilidade Urbana</p>
                    <p class="mb-0"><small>Complemento de Dados para Interdi√ß√£o</small></p>
                </div>
            </div>
        </div>
    </div>

    <div class="container py-4">
        <div id="formInterdicao">
            <div class="protocolo-info">
                <h5><i class="bi bi-info-circle"></i> Informa√ß√£o Importante</h5>
<p class="mb-0"><small>Instu√ß√µes: gere um pdf com as informa√ß√µes do presente formul√°rio e anexe no google forms</small></p>
            </div>

            <div class="form-section">
                <h3 class="section-title">1. N√∫mero do Protocolo</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">N√∫mero do Protocolo SMU</label>
                        <input type="text" class="form-control" name="numero_protocolo" required
                               placeholder="Digite o n√∫mero do protocolo fornecido pelo SMU"
                               id="input-protocolo">
                        <small class="text-muted">Exemplo: SMU-20231201-00123 ou 2023/001234</small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Data do Protocolo</label>
                        <input type="date" class="form-control" name="data_protocolo" id="input-data-protocolo">
                        <small class="text-muted">Data em que o protocolo foi gerado (opcional)</small>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3 class="section-title">2. Dados do Respons√°vel</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">Nome Completo do Respons√°vel</label>
                        <input type="text" class="form-control" name="nome_responsavel" required
                               id="input-nome-responsavel">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">Telefone para Contato</label>
                        <input type="tel" class="form-control" name="telefone" required 
                               placeholder="(32) 99999-9999"
                               id="input-telefone">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">E-mail para Contato</label>
                        <input type="email" class="form-control" name="email" required 
                               placeholder="seu@email.com"
                               id="input-email">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3 class="section-title">3. Dados B√°sicos do Evento</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">Nome do Evento</label>
                        <input type="text" class="form-control" name="nome_evento" required
                               id="input-nome-evento">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">Tipo de Evento</label>
                        <select class="form-select" name="tipo_evento" required
                                id="select-tipo-evento">
                            <option value="">Selecione...</option>
                            <option value="corrida">Corrida de Rua</option>
                            <option value="carnaval">Bloco de Carnaval</option>
                            <option value="festival">Festival</option>
                            <option value="show">Show/Espet√°culo</option>
                            <option value="esportivo">Evento Esportivo</option>
                            <option value="religioso">Evento Religioso</option>
                            <option value="feira">Feira/Exposi√ß√£o</option>
                            <option value="obra">Obra/Constru√ß√£o</option>
                            <option value="manifestacao">Manifesta√ß√£o</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">N√∫mero de Participantes</label>
                        <div class="input-group">
                            <input type="number" class="form-control" name="participantes" min="1" required
                                   id="input-participantes" value="0">
                            <button type="button" class="btn btn-primary" id="btn-confirmar-participantes">
                                <i class="bi bi-check-circle"></i> Confirmar
                            </button>
                        </div>
                        <small class="text-muted">Informe e confirme o n√∫mero de participantes para continuar</small>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label class="form-label">P√∫blico Esperado</label>
                        <input type="number" class="form-control" name="publico_esperado" min="0"
                               id="input-publico-esperado">
                    </div>
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Descri√ß√£o do Evento</label>
                        <textarea class="form-control" name="descricao_evento" rows="2"
                                  id="textarea-descricao-evento"></textarea>
                    </div>
                </div>
                
                <div id="participantes-confirmados-box" class="participantes-confirmados hidden-section">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="text-success mb-1"><i class="bi bi-check-circle-fill"></i> N√∫mero de participantes confirmado</h5>
                            <p class="mb-0">Participantes confirmados: <strong id="numero-participantes-display">0</strong></p>
                        </div>
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="btn-alterar-participantes">
                            <i class="bi bi-pencil"></i> Alterar
                        </button>
                    </div>
                </div>
            </div>

            <div id="divisor-secoes" class="hidden-section">
                <div class="section-divider">
                    <h4 class="text-center text-primary">Detalhes da Interdi√ß√£o</h4>
                    <p class="text-center text-muted">Preencha os dados abaixo sobre a interdi√ß√£o</p>
                </div>
            </div>

            <div id="secao-periodo" class="form-section hidden-section">
                <h3 class="section-title">4. Per√≠odo do Evento</h3>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label required">Data do Evento</label>
                        <input type="date" class="form-control" name="data_evento" required
                               id="input-data-evento">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label required">Hora In√≠cio</label>
                        <input type="time" class="form-control" name="hora_inicio" required
                               id="input-hora-inicio">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label required">Hora T√©rmino</label>
                        <input type="time" class="form-control" name="hora_termino" required
                               id="input-hora-termino">
                    </div>
                </div>
            </div>

            <div id="secao-local" class="form-section hidden-section">
                <h3 class="section-title">5. Local do Evento</h3>
                <div class="row">
                    <div class="col-md-8 mb-3">
                        <label class="form-label required">Endere√ßo do Evento</label>
                        <input type="text" class="form-control" name="endereco_evento" required 
                               placeholder="Rua, n√∫mero, bairro"
                               id="input-endereco-evento">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Ponto de Refer√™ncia</label>
                        <input type="text" class="form-control" name="referencia" 
                               placeholder="Pr√≥ximo a..."
                               id="input-referencia">
                    </div>
                </div>
            </div>

            <div id="secao-interdicao" class="form-section hidden-section">
                <h3 class="section-title">6. Detalhes da Interdi√ß√£o</h3>
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label required">Ruas/Trechos a Interditar</label>
                        <textarea class="form-control" name="ruas_interditadas" rows="3" required 
                                  placeholder="Descreva detalhadamente as ruas, avenidas ou trechos que precisam ser interditados"
                                  id="textarea-ruas-interditadas"></textarea>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label required">Data da Interdi√ß√£o</label>
                        <input type="date" class="form-control" name="data_interdicao" required
                               id="input-data-interdicao">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label required">Hora In√≠cio da Interdi√ß√£o</label>
                        <input type="time" class="form-control" name="hora_interdicao_inicio" required
                               id="input-hora-interdicao-inicio">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label required">Hora T√©rmino da Interdi√ß√£o</label>
                        <input type="time" class="form-control" name="hora_interdicao_termino" required
                               id="input-hora-interdicao-termino">
                    </div>
                    <div class="col-md-12 mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="interdicao_parcial" id="interdicao_parcial">
                            <label class="form-check-label" for="interdicao_parcial">
                                Interdi√ß√£o Parcial (apenas uma faixa/pista)
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div id="secao-sinalizacao" class="form-section hidden-section">
                <p> ¬ß1¬∫ CTB: "A responsabilidade pela sinaliza√ß√£o √© do respons√°vel pela execu√ß√£o ou manuten√ß√£o da obra ou evento."</p>
                <h3 class="section-title">7. Sinaliza√ß√£o que possui</h3>
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Cones</label>
                        <input type="number" class="form-control" name="qtd_cones" min="0" value="0"
                               id="input-qtd-cones">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Cavaletes</label>
                        <input type="number" class="form-control" name="qtd_cavaletes" min="0" value="0"
                               id="input-qtd-cavaletes">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Fita Zebrada (metros)</label>
                        <input type="number" class="form-control" name="metros_fita" min="0" value="0"
                               id="input-metros-fita">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Outros</label>
                        <input type="text" class="form-control" name="outros_sinalizacao" 
                               placeholder="Especifique outros"
                               id="input-outros-sinalizacao">
                    </div>
                </div>
            </div>

            <div id="secao-agentes" class="form-section hidden-section">
                <h3 class="section-title">8. Agentes de Tr√¢nsito</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">Quantidade de Agentes</label>
                        <input type="number" class="form-control" name="qtd_agentes" min="0" required value="0"
                               id="input-qtd-agentes">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Observa√ß√µes sobre Agentes</label>
                        <textarea class="form-control" name="obs_agentes" rows="2" 
                                  placeholder="Pontos de atua√ß√£o, hor√°rios espec√≠ficos"
                                  id="textarea-obs-agentes"></textarea>
                    </div>
                </div>
            </div>

            <div id="secao-veiculos" class="form-section hidden-section">
                <h3 class="section-title">9. Ve√≠culos</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Quantidade de Ve√≠culos</label>
                        <input type="number" class="form-control" name="qtd_veiculos" min="0" value="0"
                               id="input-qtd-veiculos">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Tipo de Ve√≠culos</label>
                        <input type="text" class="form-control" name="tipo_veiculos" 
                               placeholder="Ex: carro de som, ambul√¢ncia"
                               id="input-tipo-veiculos">
                    </div>
                </div>
            </div>

            <div id="secao-anexos" class="form-section hidden-section">
                <h3 class="section-title">10. Anexos (opcional)</h3>
                
                <div class="google-forms-warning">
                    <h5><i class="bi bi-file-earmark-pdf"></i> Documenta√ß√£o Complementar</h5>
                    <p>Voc√™ pode anexar documentos complementares. Todos os dados principais ser√£o gerados em um PDF.</p>
                </div>
                
            </div>
            <div id="secao-observacoes" class="form-section hidden-section">
                <h3 class="section-title">11. Observa√ß√µes Finais</h3>
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Observa√ß√µes Adicionais</label>
                        <textarea class="form-control" name="observacoes" rows="3" 
                                  placeholder="Informa√ß√µes adicionais que julgar necess√°rias"
                                  id="textarea-observacoes"></textarea>
                    </div>
                    
                    <div class="col-md-12">
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="declaracao" required>
                            <label class="form-check-label" for="declaracao">
                                Declaro que as informa√ß√µes fornecidas s√£o verdadeiras e complementam a solicita√ß√£o de protocolo n¬∫ <span id="numero-protocolo-display">_____</span>.
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div id="div-botoes" class="text-center mt-4 hidden-section">
                <button type="button" class="btn btn-primary btn-lg px-5" id="btn-gerar-pdf">
                    <i class="bi bi-file-earmark-pdf"></i> Gerar PDF com Dados
                </button>
                <button type="button" class="btn btn-success btn-lg px-5 ms-2" id="btn-abrir-google-forms">
                    <i class="bi bi-google"></i> Ir para Google Forms
                </button>
                <button type="button" class="btn btn-secondary btn-lg px-5 ms-2" onclick="resetarFormulario()">
                    <i class="bi bi-eraser"></i> Limpar
                </button>
            </div>

            <div id="preview-section" class="form-section hidden-section">
                <h3 class="section-title">Pr√©-visualiza√ß√£o do Documento</h3>
                <div class="preview-container" id="pdf-preview">
                </div>
                <div class="text-center mt-3">
                    <button type="button" class="btn btn-primary" id="btn-baixar-pdf">
                        <i class="bi bi-download"></i> Baixar PDF
                    </button>
                    <button type="button" class="btn btn-success ms-2" id="btn-enviar-completo">
                        <i class="bi bi-send"></i> Enviar Documento Completo
                    </button>
                </div>
            </div>

            <div id="mensagem-inicial" class="text-center mt-4">
                <div class="alert alert-info">
                    <h5><i class="bi bi-arrow-down"></i> Confirme o n√∫mero de participantes</h5>
                    <p class="mb-0">Informe o n√∫mero de participantes na Se√ß√£o 3 e clique em "Confirmar" para habilitar as demais se√ß√µes do formul√°rio.</p>
                </div>
            </div>
        </div>
    </div>
    <script>
        const secoesOcultas = [
            'divisor-secoes',
            'secao-periodo',
            'secao-local',
            'secao-interdicao',
            'secao-sinalizacao',
            'secao-agentes',
            'secao-veiculos',
            'secao-anexos',
            'secao-observacoes',
            'div-botoes'
        ];

        // Elementos importantes
        const inputParticipantes = document.getElementById('input-participantes');
        const btnConfirmar = document.getElementById('btn-confirmar-participantes');
        const participantesConfirmadosBox = document.getElementById('participantes-confirmados-box');
        const numeroParticipantesDisplay = document.getElementById('numero-participantes-display');
        const btnAlterarParticipantes = document.getElementById('btn-alterar-participantes');
        const btnGerarPDF = document.getElementById('btn-gerar-pdf');
        const btnAbrirGoogleForms = document.getElementById('btn-abrir-google-forms');
        const btnBaixarPDF = document.getElementById('btn-baixar-pdf');
        const btnEnviarCompleto = document.getElementById('btn-enviar-completo');
        const mensagemInicial = document.getElementById('mensagem-inicial');
        const pdfPreview = document.getElementById('pdf-preview');
        const previewSection = document.getElementById('preview-section');
        
        let participantesConfirmados = false;
        let pdfDoc = null;
        let dadosFormulario = {};

        function confirmarParticipantes() {
            const participantes = parseInt(inputParticipantes.value);
            
            if (participantes < 1) {
                alert('Por favor, informe um n√∫mero de participantes v√°lido (m√≠nimo 1).');
                inputParticipantes.focus();
                return;
            }
            
            participantesConfirmados = true;
            numeroParticipantesDisplay.textContent = participantes;
            participantesConfirmadosBox.style.display = 'block';
            participantesConfirmadosBox.classList.remove('hidden-section');
            
            mensagemInicial.style.display = 'none';
            
            secoesOcultas.forEach(id => {
                const elemento = document.getElementById(id);
                if (elemento) {
                    elemento.style.display = 'block';
                    elemento.classList.remove('hidden-section');
                }
            });
            
            inputParticipantes.disabled = true;
            btnConfirmar.disabled = true;
            
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('input-data-evento').min = hoje;
            document.getElementById('input-data-interdicao').min = hoje;
            
            document.getElementById('divisor-secoes').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }

        function permitirAlteracaoParticipantes() {
            participantesConfirmados = false;
            participantesConfirmadosBox.style.display = 'none';
            participantesConfirmadosBox.classList.add('hidden-section');
            
            secoesOcultas.forEach(id => {
                const elemento = document.getElementById(id);
                if (elemento) {
                    elemento.style.display = 'none';
                    elemento.classList.add('hidden-section');
                }
            });
            
            previewSection.style.display = 'none';
            previewSection.classList.add('hidden-section');
            
            mensagemInicial.style.display = 'block';
            
            inputParticipantes.disabled = false;
            btnConfirmar.disabled = false;
            inputParticipantes.focus();
            inputParticipantes.select();
            inputParticipantes.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        document.getElementById('input-protocolo').addEventListener('input', function(e) {
            const protocolo = e.target.value;
            document.getElementById('numero-protocolo-display').textContent = protocolo || '_____';
        });

        btnConfirmar.addEventListener('click', confirmarParticipantes);
        btnAlterarParticipantes.addEventListener('click', permitirAlteracaoParticipantes);
        inputParticipantes.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                confirmarParticipantes();
            }
        });

        function coletarDadosFormulario() {
            dadosFormulario = {
                protocolo: document.getElementById('input-protocolo').value || 'N√£o informado',
                dataProtocolo: document.getElementById('input-data-protocolo').value || 'N√£o informada',
                nomeResponsavel: document.getElementById('input-nome-responsavel').value || 'N√£o informado',
                telefone: document.getElementById('input-telefone').value || 'N√£o informado',
                email: document.getElementById('input-email').value || 'N√£o informado',
                
                nomeEvento: document.getElementById('input-nome-evento').value || 'N√£o informado',
                tipoEvento: document.getElementById('select-tipo-evento').value || 'N√£o informado',
                participantes: document.getElementById('input-participantes').value || '0',
                publicoEsperado: document.getElementById('input-publico-esperado').value || 'N√£o informado',
                descricaoEvento: document.getElementById('textarea-descricao-evento').value || 'N√£o informada',
                
                dataEvento: document.getElementById('input-data-evento').value || 'N√£o informada',
                horaInicio: document.getElementById('input-hora-inicio').value || 'N√£o informada',
                horaTermino: document.getElementById('input-hora-termino').value || 'N√£o informada',
                
                enderecoEvento: document.getElementById('input-endereco-evento').value || 'N√£o informado',
                referencia: document.getElementById('input-referencia').value || 'N√£o informada',
                
                ruasInterditadas: document.getElementById('textarea-ruas-interditadas').value || 'N√£o informado',
                dataInterdicao: document.getElementById('input-data-interdicao').value || 'N√£o informada',
                horaInterdicaoInicio: document.getElementById('input-hora-interdicao-inicio').value || 'N√£o informada',
                horaInterdicaoTermino: document.getElementById('input-hora-interdicao-termino').value || 'N√£o informada',
                interdicaoParcial: document.getElementById('interdicao_parcial').checked ? 'Sim' : 'N√£o',

                qtdCones: document.getElementById('input-qtd-cones').value || '0',
                qtdCavaletes: document.getElementById('input-qtd-cavaletes').value || '0',
                metrosFita: document.getElementById('input-metros-fita').value || '0',
                outrosSinalizacao: document.getElementById('input-outros-sinalizacao').value || 'Nenhum',
                
                qtdAgentes: document.getElementById('input-qtd-agentes').value || '0',
                obsAgentes: document.getElementById('textarea-obs-agentes').value || 'Nenhuma',
                
                qtdVeiculos: document.getElementById('input-qtd-veiculos').value || '0',
                tipoVeiculos: document.getElementById('input-tipo-veiculos').value || 'Nenhum',
                
                observacoes: document.getElementById('textarea-observacoes').value || 'Nenhuma',
                
                timestamp: new Date().toLocaleString('pt-BR'),
                dataEnvio: new Date().toLocaleDateString('pt-BR'),
                horaEnvio: new Date().toLocaleTimeString('pt-BR')
            };
            
            return dadosFormulario;
        }

        function validarFormulario() {
            if (!participantesConfirmados) {
                alert('Por favor, confirme o n√∫mero de participantes antes de continuar.');
                inputParticipantes.focus();
                return false;
            }

            const protocolo = document.getElementById('input-protocolo').value.trim();
            if (!protocolo) {
                alert('Por favor, informe o n√∫mero do protocolo.');
                return false;
            }

            const participantes = parseInt(inputParticipantes.value);
            if (participantes < 1) {
                alert('O n√∫mero de participantes deve ser pelo menos 1.');
                return false;
            }

            const email = document.getElementById('input-email').value;
            if (!email || !email.includes('@')) {
                alert('Por favor, informe um e-mail v√°lido.');
                return false;
            }

            const dataEvento = document.getElementById('input-data-evento').value;
            const dataInterdicao = document.getElementById('input-data-interdicao').value;
            const hoje = new Date().toISOString().split('T')[0];
            
            if (dataEvento < hoje) {
                alert('A data do evento n√£o pode ser anterior √† hoje.');
                return false;
            }
            
            if (dataInterdicao < hoje) {
                alert('A data da interdi√ß√£o n√£o pode ser anterior √† hoje.');
                return false;
            }
            
            const horaInicio = document.getElementById('input-hora-inicio').value;
            const horaTermino = document.getElementById('input-hora-termino').value;
            
            if (horaInicio >= horaTermino) {
                alert('A hora de t√©rmino do evento deve ser posterior √† hora de in√≠cio.');
                return false;
            }
            
            const horaInterdicaoInicio = document.getElementById('input-hora-interdicao-inicio').value;
            const horaInterdicaoTermino = document.getElementById('input-hora-interdicao-termino').value;
            
            if (horaInterdicaoInicio >= horaInterdicaoTermino) {
                alert('A hora de t√©rmino da interdi√ß√£o deve ser posterior √† hora de in√≠cio.');
                return false;
            }
            
            return true;
        }

        // Fun√ß√£o para gerar PDF
        async function gerarPDF() {
            if (!validarFormulario()) {
                return;
            }
            
            coletarDadosFormulario();
            
            // Mostrar loading
            btnGerarPDF.innerHTML = '<i class="bi bi-hourglass-split"></i> Gerando PDF...';
            btnGerarPDF.disabled = true;
            
            try {
                // Criar PDF
                const { jsPDF } = window.jspdf;
                pdfDoc = new jsPDF();
                
                // Configura√ß√µes
                const margin = 15;
                let y = margin;
                const pageWidth = pdfDoc.internal.pageSize.getWidth();
                const pageHeight = pdfDoc.internal.pageSize.getHeight();
                
                // Cabe√ßalho
                pdfDoc.setFontSize(16);
                pdfDoc.setTextColor(0, 102, 204); // Azul SMU
                pdfDoc.text("SECRETARIA DE MOBILIDADE URBANA - SMU", pageWidth / 2, y, { align: 'center' });
                y += 8;
                pdfDoc.setFontSize(14);
                pdfDoc.text("PREFEITURA DE JUIZ DE FORA", pageWidth / 2, y, { align: 'center' });
                y += 8;
                pdfDoc.setFontSize(12);
                pdfDoc.setTextColor(0, 0, 0);
                pdfDoc.text("COMPLEMENTO DE DADOS PARA INTERDI√á√ÉO", pageWidth / 2, y, { align: 'center' });
                y += 15;
                
                // Linha separadora
                pdfDoc.setLineWidth(0.5);
                pdfDoc.line(margin, y, pageWidth - margin, y);
                y += 10;
                
                // Protocolo
                pdfDoc.setFontSize(11);
                pdfDoc.setFont(undefined, 'bold');
                pdfDoc.text("PROTOCOLO: ", margin, y);
                pdfDoc.setFont(undefined, 'normal');
                pdfDoc.text(dadosFormulario.protocolo, margin + 30, y);
                y += 7;
                pdfDoc.setFont(undefined, 'bold');
                pdfDoc.text("DATA DO PROTOCOLO: ", margin, y);
                pdfDoc.setFont(undefined, 'normal');
                pdfDoc.text(dadosFormulario.dataProtocolo, margin + 50, y);
                y += 7;
                pdfDoc.setFont(undefined, 'bold');
                pdfDoc.text("DATA DE ENVIO: ", margin, y);
                pdfDoc.setFont(undefined, 'normal');
                pdfDoc.text(dadosFormulario.timestamp, margin + 40, y);
                y += 10;
                
                // Respons√°vel
                pdfDoc.setFont(undefined, 'bold');
                pdfDoc.text("DADOS DO RESPONS√ÅVEL", margin, y);
                y += 7;
                pdfDoc.setFont(undefined, 'normal');
                pdfDoc.text(`Nome: ${dadosFormulario.nomeResponsavel}`, margin + 5, y);
                y += 5;
                pdfDoc.text(`Telefone: ${dadosFormulario.telefone}`, margin + 5, y);
                y += 5;
                pdfDoc.text(`E-mail: ${dadosFormulario.email}`, margin + 5, y);
                y += 10;
                
                // Evento
                pdfDoc.setFont(undefined, 'bold');
                pdfDoc.text("DADOS DO EVENTO", margin, y);
                y += 7;
                pdfDoc.setFont(undefined, 'normal');
                pdfDoc.text(`Nome: ${dadosFormulario.nomeEvento}`, margin + 5, y);
                y += 5;
                pdfDoc.text(`Tipo: ${dadosFormulario.tipoEvento}`, margin + 5, y);
                y += 5;
                pdfDoc.text(`Participantes: ${dadosFormulario.participantes}`, margin + 5, y);
                y += 5;
                pdfDoc.text(`P√∫blico Esperado: ${dadosFormulario.publicoEsperado}`, margin + 5, y);
                y += 5;
                
                // Descri√ß√£o do evento (com quebra de linha)
                const descricaoLines = pdfDoc.splitTextToSize(`Descri√ß√£o: ${dadosFormulario.descricaoEvento}`, pageWidth - 2 * margin - 10);
                pdfDoc.text(descricaoLines, margin + 5, y);
                y += descricaoLines.length * 5;
                y += 5;
                
                // Per√≠odo
                pdfDoc.setFont(undefined, 'bold');
                pdfDoc.text("PER√çODO DO EVENTO", margin, y);
                y += 7;
                pdfDoc.setFont(undefined, 'normal');
                pdfDoc.text(`Data: ${dadosFormulario.dataEvento}`, margin + 5, y);
                y += 5;
                pdfDoc.text(`Hor√°rio: ${dadosFormulario.horaInicio} √†s ${dadosFormulario.horaTermino}`, margin + 5, y);
                y += 10;
                
                // Local
                pdfDoc.setFont(undefined, 'bold');
                pdfDoc.text("LOCAL DO EVENTO", margin, y);
                y += 7;
                pdfDoc.setFont(undefined, 'normal');
                pdfDoc.text(`Endere√ßo: ${dadosFormulario.enderecoEvento}`, margin + 5, y);
                y += 5;
                pdfDoc.text(`Refer√™ncia: ${dadosFormulario.referencia}`, margin + 5, y);
                y += 10;
                
                // Interdi√ß√£o
                pdfDoc.setFont(undefined, 'bold');
                pdfDoc.text("DETALHES DA INTERDI√á√ÉO", margin, y);
                y += 7;
                pdfDoc.setFont(undefined, 'normal');
                
                // Ruas interditadas (com quebra de linha)
                const ruasLines = pdfDoc.splitTextToSize(`Ruas/Trechos: ${dadosFormulario.ruasInterditadas}`, pageWidth - 2 * margin - 10);
                pdfDoc.text(ruasLines, margin + 5, y);
                y += ruasLines.length * 5;
                
                pdfDoc.text(`Data da Interdi√ß√£o: ${dadosFormulario.dataInterdicao}`, margin + 5, y);
                y += 5;
                pdfDoc.text(`Hor√°rio: ${dadosFormulario.horaInterdicaoInicio} √†s ${dadosFormulario.horaInterdicaoTermino}`, margin + 5, y);
                y += 5;
                pdfDoc.text(`Interdi√ß√£o Parcial: ${dadosFormulario.interdicaoParcial}`, margin + 5, y);
                y += 10;
                
                // Sinaliza√ß√£o
                pdfDoc.setFont(undefined, 'bold');
                pdfDoc.text("SINALIZA√á√ÉO DISPON√çVEL", margin, y);
                y += 7;
                pdfDoc.setFont(undefined, 'normal');
                pdfDoc.text(`Cones: ${dadosFormulario.qtdCones}`, margin + 5, y);
                y += 5;
                pdfDoc.text(`Cavaletes: ${dadosFormulario.qtdCavaletes}`, margin + 5, y);
                y += 5;
                pdfDoc.text(`Fita Zebrada: ${dadosFormulario.metrosFita} metros`, margin + 5, y);
                y += 5;
                pdfDoc.text(`Outros: ${dadosFormulario.outrosSinalizacao}`, margin + 5, y);
                y += 10;
                
                // Agentes
                pdfDoc.setFont(undefined, 'bold');
                pdfDoc.text("AGENTES DE TR√ÇNSITO", margin, y);
                y += 7;
                pdfDoc.setFont(undefined, 'normal');
                pdfDoc.text(`Quantidade: ${dadosFormulario.qtdAgentes}`, margin + 5, y);
                y += 5;
                
                if (dadosFormulario.obsAgentes && dadosFormulario.obsAgentes !== 'Nenhuma') {
                    const obsLines = pdfDoc.splitTextToSize(`Observa√ß√µes: ${dadosFormulario.obsAgentes}`, pageWidth - 2 * margin - 10);
                    pdfDoc.text(obsLines, margin + 5, y);
                    y += obsLines.length * 5;
                }
                y += 5;
                
                // Ve√≠culos
                pdfDoc.setFont(undefined, 'bold');
                pdfDoc.text("VE√çCULOS", margin, y);
                y += 7;
                pdfDoc.setFont(undefined, 'normal');
                pdfDoc.text(`Quantidade: ${dadosFormulario.qtdVeiculos}`, margin + 5, y);
                y += 5;
                pdfDoc.text(`Tipo: ${dadosFormulario.tipoVeiculos}`, margin + 5, y);
                y += 10;
                
                // Observa√ß√µes
                if (dadosFormulario.observacoes && dadosFormulario.observacoes !== 'Nenhuma') {
                    pdfDoc.setFont(undefined, 'bold');
                    pdfDoc.text("OBSERVA√á√ïES ADICIONAIS", margin, y);
                    y += 7;
                    pdfDoc.setFont(undefined, 'normal');
                    const obsLines = pdfDoc.splitTextToSize(dadosFormulario.observacoes, pageWidth - 2 * margin - 10);
                    pdfDoc.text(obsLines, margin + 5, y);
                    y += obsLines.length * 5;
                    y += 5;
                }
                
                // Declara√ß√£o
                y += 5;
                pdfDoc.setFont(undefined, 'italic');
                pdfDoc.setFontSize(10);
                const declaracao = `Declaro que as informa√ß√µes fornecidas s√£o verdadeiras e complementam a solicita√ß√£o de protocolo n¬∫ ${dadosFormulario.protocolo}.`;
                const decLines = pdfDoc.splitTextToSize(declaracao, pageWidth - 2 * margin);
                pdfDoc.text(decLines, margin, y);
                y += decLines.length * 4;
                
                // Rodap√©
                y = pageHeight - 20;
                pdfDoc.setFontSize(8);
                pdfDoc.setTextColor(100, 100, 100);
                pdfDoc.text("Documento gerado automaticamente pelo Sistema de Complemento de Dados - SMU Juiz de Fora", pageWidth / 2, y, { align: 'center' });
                y += 4;
                pdfDoc.text(`Gerado em: ${dadosFormulario.timestamp}`, pageWidth / 2, y, { align: 'center' });
                
                // Mostrar preview
                mostrarPreviewPDF();
                
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                alert('Erro ao gerar PDF. Por favor, tente novamente.');
            } finally {
                btnGerarPDF.innerHTML = '<i class="bi bi-file-earmark-pdf"></i> Gerar PDF com Dados';
                btnGerarPDF.disabled = false;
            }
        }

        // Fun√ß√£o para mostrar preview do PDF
        function mostrarPreviewPDF() {
            // Gerar preview em HTML
            let previewHTML = `
                <div style="font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; background: white; border: 1px solid #ccc;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h3 style="color: #0066cc; margin: 0;">SECRETARIA DE MOBILIDADE URBANA - SMU</h3>
                        <h4 style="margin: 5px 0;">PREFEITURA DE JUIZ DE FORA</h4>
                        <h5 style="margin: 5px 0; color: #333;">COMPLEMENTO DE DADOS PARA INTERDI√á√ÉO</h5>
                    </div>
                    <hr style="border: 1px solid #0066cc;">
                    
                    <div style="margin-bottom: 15px;">
                        <p><strong>PROTOCOLO:</strong> ${dadosFormulario.protocolo}</p>
                        <p><strong>DATA DO PROTOCOLO:</strong> ${dadosFormulario.dataProtocolo}</p>
                        <p><strong>DATA DE ENVIO:</strong> ${dadosFormulario.timestamp}</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #0066cc; border-bottom: 1px solid #eee; padding-bottom: 5px;">DADOS DO RESPONS√ÅVEL</h4>
                        <p><strong>Nome:</strong> ${dadosFormulario.nomeResponsavel}</p>
                        <p><strong>Telefone:</strong> ${dadosFormulario.telefone}</p>
                        <p><strong>E-mail:</strong> ${dadosFormulario.email}</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #0066cc; border-bottom: 1px solid #eee; padding-bottom: 5px;">DADOS DO EVENTO</h4>
                        <p><strong>Nome:</strong> ${dadosFormulario.nomeEvento}</p>
                        <p><strong>Tipo:</strong> ${dadosFormulario.tipoEvento}</p>
                        <p><strong>Participantes:</strong> ${dadosFormulario.participantes}</p>
                        <p><strong>P√∫blico Esperado:</strong> ${dadosFormulario.publicoEsperado}</p>
                        <p><strong>Descri√ß√£o:</strong> ${dadosFormulario.descricaoEvento}</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #0066cc; border-bottom: 1px solid #eee; padding-bottom: 5px;">PER√çODO DO EVENTO</h4>
                        <p><strong>Data:</strong> ${dadosFormulario.dataEvento}</p>
                        <p><strong>Hor√°rio:</strong> ${dadosFormulario.horaInicio} √†s ${dadosFormulario.horaTermino}</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #0066cc; border-bottom: 1px solid #eee; padding-bottom: 5px;">LOCAL DO EVENTO</h4>
                        <p><strong>Endere√ßo:</strong> ${dadosFormulario.enderecoEvento}</p>
                        <p><strong>Refer√™ncia:</strong> ${dadosFormulario.referencia}</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #0066cc; border-bottom: 1px solid #eee; padding-bottom: 5px;">DETALHES DA INTERDI√á√ÉO</h4>
                        <p><strong>Ruas/Trechos:</strong> ${dadosFormulario.ruasInterditadas}</p>
                        <p><strong>Data da Interdi√ß√£o:</strong> ${dadosFormulario.dataInterdicao}</p>
                        <p><strong>Hor√°rio:</strong> ${dadosFormulario.horaInterdicaoInicio} √†s ${dadosFormulario.horaInterdicaoTermino}</p>
                        <p><strong>Interdi√ß√£o Parcial:</strong> ${dadosFormulario.interdicaoParcial}</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #0066cc; border-bottom: 1px solid #eee; padding-bottom: 5px;">SINALIZA√á√ÉO DISPON√çVEL</h4>
                        <p><strong>Cones:</strong> ${dadosFormulario.qtdCones}</p>
                        <p><strong>Cavaletes:</strong> ${dadosFormulario.qtdCavaletes}</p>
                        <p><strong>Fita Zebrada:</strong> ${dadosFormulario.metrosFita} metros</p>
                        <p><strong>Outros:</strong> ${dadosFormulario.outrosSinalizacao}</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #0066cc; border-bottom: 1px solid #eee; padding-bottom: 5px;">AGENTES DE TR√ÇNSITO</h4>
                        <p><strong>Quantidade:</strong> ${dadosFormulario.qtdAgentes}</p>
                        <p><strong>Observa√ß√µes:</strong> ${dadosFormulario.obsAgentes}</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #0066cc; border-bottom: 1px solid #eee; padding-bottom: 5px;">VE√çCULOS</h4>
                        <p><strong>Quantidade:</strong> ${dadosFormulario.qtdVeiculos}</p>
                        <p><strong>Tipo:</strong> ${dadosFormulario.tipoVeiculos}</p>
                    </div>
                    
                    ${dadosFormulario.observacoes && dadosFormulario.observacoes !== 'Nenhuma' ? `
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #0066cc; border-bottom: 1px solid #eee; padding-bottom: 5px;">OBSERVA√á√ïES ADICIONAIS</h4>
                        <p>${dadosFormulario.observacoes}</p>
                    </div>
                    ` : ''}
                    
                    <div style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-left: 4px solid #0066cc;">
                        <p style="font-style: italic; margin: 0;">
                            Declaro que as informa√ß√µes fornecidas s√£o verdadeiras e complementam a solicita√ß√£o de protocolo n¬∫ ${dadosFormulario.protocolo}.
                        </p>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center; font-size: 0.8em; color: #666;">
                        <p>Documento gerado automaticamente pelo Sistema de Complemento de Dados - SMU Juiz de Fora</p>
                        <p>Gerado em: ${dadosFormulario.timestamp}</p>
                    </div>
                </div>
            `;
            
            pdfPreview.innerHTML = previewHTML;
            previewSection.style.display = 'block';
            previewSection.classList.remove('hidden-section');
            
            // Rolar para o preview
            previewSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Fun√ß√£o para baixar PDF
        function baixarPDF() {
            if (!pdfDoc) {
                alert('Por favor, gere o PDF primeiro.');
                return;
            }
            
            const nomeArquivo = `SMU_Complemento_${dadosFormulario.protocolo.replace(/\//g, '_')}_${new Date().toISOString().slice(0,10)}.pdf`;
            pdfDoc.save(nomeArquivo);
        }

        // Fun√ß√£o para abrir Google Forms
        function abrirGoogleForms() {
            if (!validarFormulario()) {
                return;
            }
            
            const protocolo = document.getElementById('input-protocolo').value;
            const confirmacao = `
üìã PR√ìXIMOS PASSOS:

1. O Google Forms ser√° aberto em uma nova aba
2. Preencha os dados MANUALMENTE no Google Forms
3. Use o PDF gerado como refer√™ncia
4. Anexe os documentos solicitados
5. Clique em "Enviar"

Protocolo: ${protocolo}

Deseja abrir o Google Forms agora?
            `;
            
            if (confirm(confirmacao)) {
                window.open('https://docs.google.com/forms/d/e/1FAIpQLSecrCe2Xanm-Srq590wiOzNXaD_UwJAoTwCYukTIVUoMbFW0w/viewform', '_blank');
            }
        }

        // Fun√ß√£o para enviar documento completo
        function enviarDocumentoCompleto() {
            if (!pdfDoc) {
                alert('Por favor, gere o PDF primeiro.');
                return;
            }
            
            const protocolo = document.getElementById('input-protocolo').value;
            const email = document.getElementById('input-email').value;
            
            const mensagem = `
üì§ ENVIO DO DOCUMENTO COMPLETO

Os seguintes itens ser√£o enviados:
1. PDF com todos os dados do formul√°rio
2. Instru√ß√µes para completar o processo

Email do solicitante: ${email}
Protocolo: ${protocolo}

Deseja continuar?
            `;
            
            if (confirm(mensagem)) {
                // Baixar o PDF
                baixarPDF();
                
                // Mostrar instru√ß√µes
                alert(`
‚úÖ PDF BAIXADO COM SUCESSO!

üìã PR√ìXIMOS PASSOS:

1. O PDF foi baixado no seu computador
2. Abra o Google Forms do SMU:
   https://docs.google.com/forms/d/e/1FAIpQLSecrCe2Xanm-Srq590wiOzNXaD_UwJAoTwCYukTIVUoMbFW0w/viewform

3. Preencha os dados no Google Forms
4. No campo de observa√ß√µes, mencione:
   "Dados completos em anexo - PDF gerado automaticamente"

5. Anexe:
   ‚Ä¢ O PDF que acabou de baixar
   ‚Ä¢ Os documentos solicitados

6. Clique em ENVIAR

Obrigado por utilizar o sistema do SMU!
                `);
                
                // Abrir Google Forms
                window.open('https://docs.google.com/forms/d/e/1FAIpQLSecrCe2Xanm-Srq590wiOzNXaD_UwJAoTwCYukTIVUoMbFW0w/viewform', '_blank');
            }
        }

        // Event Listeners
        btnGerarPDF.addEventListener('click', gerarPDF);
        btnBaixarPDF.addEventListener('click', baixarPDF);
        btnAbrirGoogleForms.addEventListener('click', abrirGoogleForms);
        btnEnviarCompleto.addEventListener('click', enviarDocumentoCompleto);

        // Fun√ß√£o para resetar formul√°rio completamente
        function resetarFormulario() {
            if (confirm('Deseja limpar todo o formul√°rio? Todos os dados ser√£o perdidos.')) {
                // Resetar estado
                participantesConfirmados = false;
                pdfDoc = null;
                dadosFormulario = {};
                
                // Esconder todas as se√ß√µes exceto as primeiras
                secoesOcultas.forEach(id => {
                    const elemento = document.getElementById(id);
                    if (elemento) {
                        elemento.style.display = 'none';
                        elemento.classList.add('hidden-section');
                    }
                });
                
                // Esconder preview
                previewSection.style.display = 'none';
                previewSection.classList.add('hidden-section');
                
                // Esconder caixa de confirma√ß√£o
                participantesConfirmadosBox.style.display = 'none';
                participantesConfirmadosBox.classList.add('hidden-section');
                
                // Mostrar mensagem inicial
                mensagemInicial.style.display = 'block';
                
                // Habilitar campos
                inputParticipantes.disabled = false;
                btnConfirmar.disabled = false;
                
                // Resetar todos os campos
                document.querySelectorAll('#formInterdicao input, #formInterdicao select, #formInterdicao textarea').forEach(element => {
                    if (element.type !== 'button') {
                        element.value = '';
                    }
                });
                
                // Resetar checkbox
                document.getElementById('declaracao').checked = false;
                document.getElementById('interdicao_parcial').checked = false;
                
                // Resetar file inputs
                document.getElementById('input-file-oficio').value = '';
                document.getElementById('input-file-croqui').value = '';
                document.getElementById('input-file-crlv').value = '';
                
                // Resetar os displays
                document.getElementById('numero-protocolo-display').textContent = '_____';
                numeroParticipantesDisplay.textContent = '0';
                
                // Resetar preview
                pdfPreview.innerHTML = '';
                
                // Resetar bot√µes
                btnGerarPDF.innerHTML = '<i class="bi bi-file-earmark-pdf"></i> Gerar PDF com Dados';
                btnGerarPDF.disabled = false;
                
                // Focar no primeiro campo
                document.getElementById('input-protocolo').focus();
            }
        }

        // Configura√ß√£o inicial
        document.addEventListener('DOMContentLoaded', function() {
            // Focar no campo do protocolo
            document.getElementById('input-protocolo').focus();
            
            // Verificar se j√° tem participantes preenchidos (em caso de refresh)
            if (parseInt(inputParticipantes.value) >= 1) {
                // Se j√° tiver valor, mostrar bot√£o de confirma√ß√£o destacado
                btnConfirmar.classList.add('btn-success');
            }
        });
    </script>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
</body>
</html>






