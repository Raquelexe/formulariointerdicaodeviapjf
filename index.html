<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitação de Interdição - SMU JF</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --primary: #0066cc; --secondary: #003366; }
        body { font-family: 'Segoe UI', sans-serif; background: #f8f9fa; }
        .header { background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: white; padding: 1.5rem 0; }
        .form-section { background: white; border-radius: 10px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .required::after { content: " *"; color: red; }
        .section-title { color: var(--primary); border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-bottom: 20px; }
        .logo-header { max-height: 70px; margin-right: 15px; }
        .protocolo-info { background: #e7f3ff; border-left: 4px solid var(--primary); padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .hidden-section { display: none; }
        .section-divider { border-top: 2px dashed #dee2e6; margin: 2rem 0; padding-top: 2rem; }
        @media (max-width: 768px) {
            .logo-header { max-height: 50px; margin-right: 10px; }
            .header { padding: 1rem 0; }
        }
    </style>
</head>
<body>
    <!-- Cabeçalho com Logo -->
    <div class="header">
        <div class="container">
            <div class="d-flex align-items-center justify-content-center">
                <img src="logo-horizontal" 
                     alt="Logo SMU Juiz de Fora" 
                     class="logo-header">
                <div class="text-center">
                    <h1 class="mb-1" style="font-size: 1.8rem;">SMU Juiz de Fora</h1>
                    <p class="mb-0" style="font-size: 0.9rem;">Secretaria de Mobilidade Urbana</p>
                    <p class="mb-0"><small>Complemento de Dados para Interdição</small></p>
                </div>
            </div>
        </div>
    </div>

    <div class="container py-4">
        <form id="formInterdicao" method="POST" netlify enctype="multipart/form-data">
            
            <!-- INFORMAÇÃO SOBRE O PROTOCOLO -->
            <div class="protocolo-info">
                <h5><i class="bi bi-info-circle"></i> Informação Importante</h5>
                <p class="mb-0">Este formulário é para complementar dados de uma solicitação já existente. 
                Você deve ter o <strong>número do protocolo</strong> gerado pelo sistema principal do SMU.</p>
            </div>

            <!-- SEÇÃO 1: PROTOCOLO -->
            <div class="form-section">
                <h3 class="section-title">1. Número do Protocolo</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">Número do Protocolo SMU</label>
                        <input type="text" class="form-control" name="numero_protocolo" required
                               placeholder="Digite o número do protocolo fornecido pelo SMU"
                               id="input-protocolo">
                        <small class="text-muted">Exemplo: SMU-20231201-00123 ou 2023/001234</small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Data do Protocolo</label>
                        <input type="date" class="form-control" name="data_protocolo">
                        <small class="text-muted">Data em que o protocolo foi gerado (opcional)</small>
                    </div>
                </div>
            </div>

            <!-- SEÇÃO 2: DADOS DO RESPONSÁVEL -->
            <div class="form-section">
                <h3 class="section-title">2. Dados do Responsável</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">Nome Completo do Responsável</label>
                        <input type="text" class="form-control" name="nome_responsavel" required
                               id="input-nome-responsavel">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">Telefone para Contato</label>
                        <input type="tel" class="form-control" name="telefone" required 
                               placeholder="(32) 99999-9999"
                               id="input-telefone">
                    </div>
                </div>
            </div>

            <!-- SEÇÃO 3: DADOS BÁSICOS DO EVENTO -->
            <div class="form-section">
                <h3 class="section-title">3. Dados Básicos do Evento</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">Nome do Evento</label>
                        <input type="text" class="form-control" name="nome_evento" required
                               id="input-nome-evento">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">Tipo de Evento</label>
                        <select class="form-select" name="tipo_evento" required
                                id="select-tipo-evento">
                            <option value="">Selecione...</option>
                            <option value="corrida">Corrida de Rua</option>
                            <option value="carnaval">Bloco de Carnaval</option>
                            <option value="festival">Festival</option>
                            <option value="show">Show/Espetáculo</option>
                            <option value="esportivo">Evento Esportivo</option>
                            <option value="religioso">Evento Religioso</option>
                            <option value="feira">Feira/Exposição</option>
                            <option value="obra">Obra/Construção</option>
                            <option value="manifestacao">Manifestação</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">Número de Participantes</label>
                        <input type="number" class="form-control" name="participantes" min="1" required
                               id="input-participantes">
                        <small class="text-muted">Preencha este campo para continuar</small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Público Esperado</label>
                        <input type="number" class="form-control" name="publico_esperado" min="0"
                               id="input-publico-esperado">
                    </div>
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Descrição do Evento</label>
                        <textarea class="form-control" name="descricao_evento" rows="2"
                                  id="textarea-descricao-evento"></textarea>
                    </div>
                </div>
            </div>

            <!-- DIVISÓRIA - Só aparece depois de preencher participantes -->
            <div id="divisor-secoes" class="hidden-section">
                <div class="section-divider">
                    <h4 class="text-center text-primary">Detalhes da Interdição</h4>
                    <p class="text-center text-muted">Preencha os dados abaixo sobre a interdição</p>
                </div>
            </div>

            <!-- SEÇÃO 4: PERÍODO DO EVENTO (oculta inicialmente) -->
            <div id="secao-periodo" class="form-section hidden-section">
                <h3 class="section-title">4. Período do Evento</h3>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label required">Data do Evento</label>
                        <input type="date" class="form-control" name="data_evento" required
                               id="input-data-evento">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label required">Hora Início</label>
                        <input type="time" class="form-control" name="hora_inicio" required
                               id="input-hora-inicio">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label required">Hora Término</label>
                        <input type="time" class="form-control" name="hora_termino" required
                               id="input-hora-termino">
                    </div>
                </div>
            </div>

            <!-- SEÇÃO 5: LOCAL DO EVENTO (oculta inicialmente) -->
            <div id="secao-local" class="form-section hidden-section">
                <h3 class="section-title">5. Local do Evento</h3>
                <div class="row">
                    <div class="col-md-8 mb-3">
                        <label class="form-label required">Endereço do Evento</label>
                        <input type="text" class="form-control" name="endereco_evento" required 
                               placeholder="Rua, número, bairro"
                               id="input-endereco-evento">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Ponto de Referência</label>
                        <input type="text" class="form-control" name="referencia" 
                               placeholder="Próximo a..."
                               id="input-referencia">
                    </div>
                </div>
            </div>

            <!-- SEÇÃO 6: DETALHES DA INTERDIÇÃO (oculta inicialmente) -->
            <div id="secao-interdicao" class="form-section hidden-section">
                <h3 class="section-title">6. Detalhes da Interdição</h3>
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label required">Ruas/Trechos a Interditar</label>
                        <textarea class="form-control" name="ruas_interditadas" rows="3" required 
                                  placeholder="Descreva detalhadamente as ruas, avenidas ou trechos que precisam ser interditados"
                                  id="textarea-ruas-interditadas"></textarea>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label required">Data da Interdição</label>
                        <input type="date" class="form-control" name="data_interdicao" required
                               id="input-data-interdicao">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label required">Hora Início da Interdição</label>
                        <input type="time" class="form-control" name="hora_interdicao_inicio" required
                               id="input-hora-interdicao-inicio">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label required">Hora Término da Interdição</label>
                        <input type="time" class="form-control" name="hora_interdicao_termino" required
                               id="input-hora-interdicao-termino">
                    </div>
                    <div class="col-md-12 mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="interdicao_parcial" id="interdicao_parcial">
                            <label class="form-check-label" for="interdicao_parcial">
                                Interdição Parcial (apenas uma faixa/pista)
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SEÇÃO 7: SINALIZAÇÃO (oculta inicialmente) -->
            <div id="secao-sinalizacao" class="form-section hidden-section">
                <h3 class="section-title">7. Sinalização Necessária</h3>
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Cones</label>
                        <input type="number" class="form-control" name="qtd_cones" min="0" value="0"
                               id="input-qtd-cones">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Cavaletes</label>
                        <input type="number" class="form-control" name="qtd_cavaletes" min="0" value="0"
                               id="input-qtd-cavaletes">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Fita Zebrada (metros)</label>
                        <input type="number" class="form-control" name="metros_fita" min="0" value="0"
                               id="input-metros-fita">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Outros</label>
                        <input type="text" class="form-control" name="outros_sinalizacao" 
                               placeholder="Especifique outros"
                               id="input-outros-sinalizacao">
                    </div>
                </div>
            </div>

            <!-- SEÇÃO 8: AGENTES DE TRÂNSITO (oculta inicialmente) -->
            <div id="secao-agentes" class="form-section hidden-section">
                <h3 class="section-title">8. Agentes de Trânsito</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">Quantidade de Agentes</label>
                        <input type="number" class="form-control" name="qtd_agentes" min="0" required value="0"
                               id="input-qtd-agentes">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Observações sobre Agentes</label>
                        <textarea class="form-control" name="obs_agentes" rows="2" 
                                  placeholder="Pontos de atuação, horários específicos"
                                  id="textarea-obs-agentes"></textarea>
                    </div>
                </div>
            </div>

            <!-- SEÇÃO 9: VEÍCULOS (oculta inicialmente) -->
            <div id="secao-veiculos" class="form-section hidden-section">
                <h3 class="section-title">9. Veículos</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Quantidade de Veículos</label>
                        <input type="number" class="form-control" name="qtd_veiculos" min="0" value="0"
                               id="input-qtd-veiculos">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Tipo de Veículos</label>
                        <input type="text" class="form-control" name="tipo_veiculos" 
                               placeholder="Ex: carro de som, ambulância"
                               id="input-tipo-veiculos">
                    </div>
                </div>
            </div>

            <!-- SEÇÃO 10: ANEXOS (oculta inicialmente) -->
            <div id="secao-anexos" class="form-section hidden-section">
                <h3 class="section-title">10. Anexos (opcional)</h3>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Ofício/Baixo-assinado</label>
                        <input type="file" class="form-control" name="file_oficio" accept=".pdf,.jpg,.png"
                               id="input-file-oficio">
                        <small class="text-muted">Documento com aprovação</small>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Croqui do Trajeto</label>
                        <input type="file" class="form-control" name="file_croqui" accept=".pdf,.jpg,.png"
                               id="input-file-croqui">
                        <small class="text-muted">Mapa/croqui da área</small>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">CRLVs dos Veículos</label>
                        <input type="file" class="form-control" name="file_crlv[]" multiple accept=".pdf,.jpg,.png"
                               id="input-file-crlv">
                        <small class="text-muted">Documentos dos veículos</small>
                    </div>
                </div>
            </div>

            <!-- SEÇÃO 11: OBSERVAÇÕES FINAIS (oculta inicialmente) -->
            <div id="secao-observacoes" class="form-section hidden-section">
                <h3 class="section-title">11. Observações Finais</h3>
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Observações Adicionais</label>
                        <textarea class="form-control" name="observacoes" rows="3" 
                                  placeholder="Informações adicionais que julgar necessárias"
                                  id="textarea-observacoes"></textarea>
                    </div>
                    
                    <div class="col-md-12">
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="declaracao" required>
                            <label class="form-check-label" for="declaracao">
                                Declaro que as informações fornecidas são verdadeiras e complementam a solicitação de protocolo nº <span id="numero-protocolo-display">_____</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BOTÃO DE ENVIO (oculto inicialmente) -->
            <div id="div-botoes" class="text-center mt-4 hidden-section">
                <button type="submit" class="btn btn-primary btn-lg px-5">
                    <i class="bi bi-send"></i> Enviar Dados Complementares
                </button>
                <button type="reset" class="btn btn-secondary btn-lg px-5 ms-2" onclick="resetarFormulario()">
                    <i class="bi bi-eraser"></i> Limpar
                </button>
            </div>

            <!-- MENSAGEM INSTRUTIVA (visível inicialmente) -->
            <div id="mensagem-inicial" class="text-center mt-4">
                <div class="alert alert-info">
                    <h5><i class="bi bi-arrow-down"></i> Preencha os dados básicos acima</h5>
                    <p class="mb-0">Complete as informações da Seção 3 (número de participantes) para habilitar as demais seções do formulário.</p>
                </div>
            </div>
        </form>
    </div>

    <!-- JavaScript -->
    <script>
        // Array com IDs de todas as seções que serão mostradas depois
        const secoesOcultas = [
            'divisor-secoes',
            'secao-periodo',
            'secao-local',
            'secao-interdicao',
            'secao-sinalizacao',
            'secao-agentes',
            'secao-veiculos',
            'secao-anexos',
            'secao-observacoes',
            'div-botoes'
        ];

        // Elementos que serão monitorados
        const inputParticipantes = document.getElementById('input-participantes');
        const mensagemInicial = document.getElementById('mensagem-inicial');

        // Função para verificar se pode mostrar as seções
        function verificarParticipantes() {
            const participantes = parseInt(inputParticipantes.value);
            
            if (participantes >= 1) {
                // Esconder mensagem inicial
                mensagemInicial.style.display = 'none';
                
                // Mostrar todas as seções ocultas
                secoesOcultas.forEach(id => {
                    const elemento = document.getElementById(id);
                    if (elemento) {
                        elemento.style.display = 'block';
                        elemento.classList.remove('hidden-section');
                    }
                });
                
                // Configurar datas mínimas
                const hoje = new Date().toISOString().split('T')[0];
                document.getElementById('input-data-evento').min = hoje;
                document.getElementById('input-data-interdicao').min = hoje;
                
                // Rolar suavemente para a primeira seção mostrada
                document.getElementById('divisor-secoes').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
                
            } else {
                // Esconder todas as seções
                secoesOcultas.forEach(id => {
                    const elemento = document.getElementById(id);
                    if (elemento) {
                        elemento.style.display = 'none';
                        elemento.classList.add('hidden-section');
                    }
                });
                
                // Mostrar mensagem inicial
                mensagemInicial.style.display = 'block';
            }
        }

        // Atualizar número do protocolo na declaração
        document.getElementById('input-protocolo').addEventListener('input', function(e) {
            const protocolo = e.target.value;
            document.getElementById('numero-protocolo-display').textContent = protocolo || '_____';
        });

        // Monitorar alteração no campo de participantes
        inputParticipantes.addEventListener('input', verificarParticipantes);
        inputParticipantes.addEventListener('change', verificarParticipantes);

        // Validações do formulário
        document.getElementById('formInterdicao').addEventListener('submit', function(e) {
            // Validar protocolo
            const protocolo = document.getElementById('input-protocolo').value.trim();
            if (!protocolo) {
                e.preventDefault();
                alert('Por favor, informe o número do protocolo.');
                return false;
            }

            // Validar participantes
            const participantes = parseInt(inputParticipantes.value);
            if (participantes < 1) {
                e.preventDefault();
                alert('O número de participantes deve ser pelo menos 1.');
                return false;
            }

            // Validar datas
            const dataEvento = document.getElementById('input-data-evento').value;
            const dataInterdicao = document.getElementById('input-data-interdicao').value;
            const hoje = new Date().toISOString().split('T')[0];
            
            if (dataEvento < hoje) {
                e.preventDefault();
                alert('A data do evento não pode ser anterior à hoje.');
                return false;
            }
            
            if (dataInterdicao < hoje) {
                e.preventDefault();
                alert('A data da interdição não pode ser anterior à hoje.');
                return false;
            }
            
            // Validar horários
            const horaInicio = document.getElementById('input-hora-inicio').value;
            const horaTermino = document.getElementById('input-hora-termino').value;
            
            if (horaInicio >= horaTermino) {
                e.preventDefault();
                alert('A hora de término do evento deve ser posterior à hora de início.');
                return false;
            }
            
            const horaInterdicaoInicio = document.getElementById('input-hora-interdicao-inicio').value;
            const horaInterdicaoTermino = document.getElementById('input-hora-interdicao-termino').value;
            
            if (horaInterdicaoInicio >= horaInterdicaoTermino) {
                e.preventDefault();
                alert('A hora de término da interdição deve ser posterior à hora de início.');
                return false;
            }
            
            // Confirmação
            if (!confirm(`Confirmar envio dos dados complementares para o protocolo ${protocolo}?\n\nOs dados serão vinculados ao protocolo informado.`)) {
                e.preventDefault();
                return false;
            }
            
            return true;
        });

        // Função para resetar formulário completamente
        function resetarFormulario() {
            if (confirm('Deseja limpar todo o formulário? Todos os dados serão perdidos.')) {
                // Esconder todas as seções exceto as primeiras
                secoesOcultas.forEach(id => {
                    const elemento = document.getElementById(id);
                    if (elemento) {
                        elemento.style.display = 'none';
                        elemento.classList.add('hidden-section');
                    }
                });
                
                // Mostrar mensagem inicial
                mensagemInicial.style.display = 'block';
                
                // Resetar o formulário (isso limpa os valores)
                document.getElementById('formInterdicao').reset();
                
                // Resetar o display do protocolo
                document.getElementById('numero-protocolo-display').textContent = '_____';
                
                // Focar no primeiro campo
                document.getElementById('input-protocolo').focus();
            }
        }

        // Configuração inicial
        document.addEventListener('DOMContentLoaded', function() {
            // Focar no campo do protocolo
            document.getElementById('input-protocolo').focus();
            
            // Verificar se já tem participantes preenchidos (em caso de refresh)
            verificarParticipantes();
        });
    </script>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
</body>
</html>
