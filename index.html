<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Formulário de Interdição de Via</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      padding: 20px;
    }
    form {
      background: #fff;
      max-width: 900px;
      margin: auto;
      padding: 20px;
      border-radius: 6px;
    }
    fieldset {
      margin-bottom: 20px;
      border: 1px solid #ccc;
      padding: 15px;
    }
    legend {
      font-weight: bold;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, textarea, button {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }
    button {
      margin-top: 20px;
      background: #0057a3;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #003f75;
    }
  </style>
</head>
<body>

<h2 style="text-align:center;">Formulário de Interdição de Via</h2>

<form id="formInterdicao">

  <fieldset>
    <legend>Identificação</legend>

    <label>Protocolo
      <input type="text" id="input-protocolo" name="protocolo" required>
    </label>

    <label>Responsável
      <input type="text" name="responsavel" required>
    </label>

    <label>Telefone
      <input type="text" name="telefone">
    </label>
  </fieldset>

  <fieldset>
    <legend>Evento</legend>

    <label>Descrição do Evento
      <input type="text" name="descricao_evento" required>
    </label>

    <label>Data
      <input type="date" name="data_evento" required>
    </label>

    <label>Horário
      <input type="time" name="horario_evento">
    </label>
  </fieldset>

  <fieldset>
    <legend>Local</legend>

    <label>Endereço
      <input type="text" name="endereco" required>
    </label>

    <label>Ruas Interditadas
      <textarea name="ruas_interditadas"></textarea>
    </label>
  </fieldset>

  <fieldset>
    <legend>Interdição</legend>

    <label>
      <input type="checkbox" id="interdicao_parcial">
      Interdição Parcial
    </label>

    <label>Horário Início
      <input type="time" name="horario_inicio">
    </label>

    <label>Horário Fim
      <input type="time" name="horario_fim">
    </label>
  </fieldset>

  <fieldset>
    <legend>Sinalização da Interdição</legend>

    <label>Cones (quantidade)
      <input type="number" name="cones" min="0">
    </label>

    <label>Fita Zebrada (quantidade / metros)
      <input type="text" name="fita_zebrada">
    </label>

    <label>Gradil (quantidade)
      <input type="number" name="gradil" min="0">
    </label>

    <label>Outros (especificar)
      <input type="text" name="outros_sinalizacao">
    </label>
  </fieldset>

  <fieldset>
    <legend>Observações</legend>
    <textarea name="observacoes"></textarea>
  </fieldset>

  <button type="submit">Gerar Relatório</button>

</form>

<script>
document.getElementById('formInterdicao').addEventListener('submit', function (e) {
  e.preventDefault();

  const protocolo =
    document.getElementById('input-protocolo').value || 'SEM_PROTOCOLO';

  if (!confirm(`Confirmar geração do relatório para o protocolo ${protocolo}?`)) {
    return;
  }

  const formData = new FormData(this);
  const linhas = [];
  linhas.push(['Campo', 'Valor']);

  for (const [campo, valor] of formData.entries()) {
    linhas.push([campo, valor]);
  }

  linhas.push([
    'interdicao_parcial',
    document.getElementById('interdicao_parcial').checked ? 'Sim' : 'Não'
  ]);

  const csv = linhas
    .map(l => l.map(v => `"${String(v).replace(/"/g, '""')}"`).join(';'))
    .join('\n');

  const nomeArquivo = `Interdicao_${protocolo}.csv`;

  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = nomeArquivo;
  link.click();

  alert('Relatório gerado com sucesso.\nArquivo pronto para abrir no Excel.');
});
</script>

</body>
</html>

